# ì…ê³  ì˜ˆì • í…Œì´ë¸” ëª¨ë“ˆ (Inbound Table Module) - PRD

## ëª©í‘œ
ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ê¸°ë°˜ ì…ê³  ì˜ˆì •/ìš´ì†¡ ë°ì´í„°ë¥¼ "ì½ê¸° ì‰¬ìš´ ì‹œê°í™” í…Œì´ë¸”"ë¡œ ë Œë”ë§í•©ë‹ˆë‹¤.

### ì£¼ìš” ê¸°ëŠ¥
- **6ê°œ ì»¬ëŸ¼ í‘œì‹œ**: ì£¼ë¬¸ë²ˆí˜¸, ê²½ë¡œ, ìš´ì†¡ëª¨ë“œ, SKU ìš”ì•½, ë°œì†¡ì¼, ì˜ˆìƒ ë„ì°©ì¼
- **ETA ìƒ‰ìƒ ì½”ë”©**:
  - ğŸ”´ ë¹¨ê°•: ê³¼ê±° ë‚ ì§œ
  - ğŸŸ¢ ì´ˆë¡: 5ì¼ ì´ë‚´
  - âš« íšŒìƒ‰: 6ì¼ ì´í›„
  - ğŸŸ  ì£¼í™©: ë¯¸í™•ì¸
- **SKU ìƒ‰ìƒ íŒ”ë ˆíŠ¸**: í•„í„°ì—ì„œ ì‚¬ìš©í•˜ëŠ” SKU ìƒ‰ìƒ ì¬ì‚¬ìš©
- **ì¸ë³´ì´ìŠ¤ ê·¸ë£¹í•‘**: ê°™ì€ ì†¡ì¥ì˜ ì—¬ëŸ¬ SKUë¥¼ í•œ í–‰ìœ¼ë¡œ ì§‘ê³„

---

## 1. ì…ë ¥ ìŠ¤í‚¤ë§ˆ (ì›ë³¸ DF: `inbound_raw`)

| ì»¬ëŸ¼ëª… | íƒ€ì… | ì„¤ëª… | ì˜ˆì‹œ |
|--------|------|------|------|
| `invoice_no` | `str` | ì£¼ë¬¸ë²ˆí˜¸/ì†¡ì¥ë²ˆí˜¸ | "INV20250115-001" |
| `from_country` | `str` | ì¶œë°œ êµ­ê°€ | "KR" |
| `to_country` | `str` | ë„ì°© êµ­ê°€ | "US" |
| `to_center` | `str` | ë„ì°© ì„¼í„° | "AMZUS" |
| `resource_code` | `str` | SKU ì½”ë“œ | "BA00021" |
| `resource_name` | `str` | í’ˆëª… | "ë¹„íƒ€ë¯¼D [30ml/-]" |
| `qty_ea` | `int` | ìˆ˜ëŸ‰ (ê°œ) | 30132 |
| `carrier_mode` | `str` | ìš´ì†¡ëª¨ë“œ | "íŠ¹ì†¡", "í•´ìš´", "SEND" |
| `onboard_date` | `date/str` | ì¶œë°œì¼ | "2025-01-15" |
| `pred_inbound_date` | `date/str/null` | ì˜ˆìƒ ì…ê³ ì¼ | "2025-01-20" ë˜ëŠ” "not_defined" |

---

## 2. ì¶œë ¥ ìŠ¤í‚¤ë§ˆ (íŒŒìƒ DF: `inbound_table`)

í•œ ì¸ë³´ì´ìŠ¤(ì†¡ì¥) = í•œ í–‰. SKUê°€ ì—¬ëŸ¬ ê°œì¸ ê²½ìš° ë¬¶ì–´ì„œ ìš”ì•½í•©ë‹ˆë‹¤.

### í‘œì‹œ ì»¬ëŸ¼

| ì»¬ëŸ¼ëª… | íƒ€ì… | ì„¤ëª… | ì˜ˆì‹œ |
|--------|------|------|------|
| `invoice_no` | `str` | ì£¼ë¬¸ë²ˆí˜¸ (ì¢Œì¸¡ ì •ë ¬, êµµê²Œ) | "INV20250115-001" |
| `route` | `str` | ê²½ë¡œ (êµµê²Œ í‘œì‹œ) | "KR â†’ US" |
| `carrier_mode` | `str` | ìš´ì†¡ëª¨ë“œ | "íŠ¹ì†¡" |
| `sku_summary` | `str` | SKU ìš”ì•½ | "BA00021: 30,132ea ì™¸ 2ì¢…" |
| `onboard_date` | `str` | ì¶œë°œì¼ (YYYY-MM-DD) | "2025-01-15" |
| `eta_text` | `str` | ì˜ˆìƒ ë„ì°©ì¼ í‘œì‹œ | "2025-01-20" ë˜ëŠ” "ë¯¸í™•ì¸" |

### ë‚´ë¶€ ì»¬ëŸ¼ (í‘œì‹œ X)

| ì»¬ëŸ¼ëª… | íƒ€ì… | ì„¤ëª… |
|--------|------|------|
| `eta_color` | `str` | ETA ìƒ‰ìƒ ì½”ë“œ ("red"/"green"/"gray"/"orange") |
| `_rep_sku` | `str` | ëŒ€í‘œ SKU ì½”ë“œ (ìƒ‰ìƒ ì ìš©ìš©) |
| `_to_center` | `str` | ë„ì°© ì„¼í„° (í•„í„°ë§ìš©) |
| `_total_qty` | `int` | ì´ ìˆ˜ëŸ‰ (í†µê³„ìš©) |

---

## 3. ë³€í™˜ ê·œì¹™ (Transformation Logic)

### 3.1 ê·¸ë£¹í•‘
- **ê¸°ì¤€**: `invoice_no` (ì£¼ë¬¸ë²ˆí˜¸)
- ê°™ì€ ì†¡ì¥ì˜ ëª¨ë“  SKUë¥¼ í•œ í–‰ìœ¼ë¡œ ì§‘ê³„

### 3.2 ëŒ€í‘œ SKU ì„ ì •
1. **1ìˆœìœ„**: ìˆ˜ëŸ‰(`qty_ea`)ì´ ê°€ì¥ ë§ì€ SKU
2. **ë™ë¥  ì‹œ**: SKU ì½”ë“œ ì‚¬ì „ìˆœ (ì•ŒíŒŒë²³ ìˆœ)

ì˜ˆì‹œ:
```python
# ë™ì¼ ì†¡ì¥ ë‚´ SKU 3ê°œ
BA00021: 1000ea  # â† ëŒ€í‘œ SKU (ìˆ˜ëŸ‰ ìµœë‹¤)
BA00022: 500ea
BA00023: 300ea
```

### 3.3 SKU ìš”ì•½ ìƒì„±
- í˜•ì‹: `"{ëŒ€í‘œSKU}: {ëŒ€í‘œìˆ˜ëŸ‰:,}ea"` + (SKUì¢…ìˆ˜ > 1ì´ë©´ `" ì™¸ {n}ì¢…"`)
- ì˜ˆì‹œ:
  - ë‹¨ì¼ SKU: `"BA00021: 30,132ea"`
  - ë‹¤ì¤‘ SKU: `"BA00021: 30,132ea ì™¸ 2ì¢…"`

### 3.4 ê²½ë¡œ (Route)
- í˜•ì‹: `"{from_country} â†’ {to_country}"`
- ì˜ˆì‹œ: `"KR â†’ US"`, `"US â†’ KR"`

### 3.5 ì¶œë°œì¼ (Onboard Date)
- ê·¸ë£¹ ë‚´ ê°€ì¥ ë¹ ë¥¸ ë‚ ì§œ ì„ íƒ
- í¬ë§·: `YYYY-MM-DD`

### 3.6 ETA ìƒ‰ìƒ ê·œì¹™

| ì¡°ê±´ | `eta_text` | `eta_color` | ì˜ë¯¸ |
|------|-----------|-------------|------|
| `pred_inbound_date`ê°€ ë¹„ì–´ìˆê±°ë‚˜ `"not_defined"` | `"ë¯¸í™•ì¸"` | `"orange"` | ğŸŸ  ë¯¸í™•ì¸ |
| ë‚ ì§œê°€ ì˜¤ëŠ˜ë³´ë‹¤ **ê³¼ê±°** | `"YYYY-MM-DD"` | `"red"` | ğŸ”´ ì§€ì—° |
| ì˜¤ëŠ˜ ~ **5ì¼ ì´ë‚´** | `"YYYY-MM-DD"` | `"green"` | ğŸŸ¢ ê¸´ê¸‰ |
| **6ì¼ ì´í›„** | `"YYYY-MM-DD"` | `"gray"` | âš« ì—¬ìœ  |

---

## 4. UI/ìŠ¤íƒ€ì¼ ìš”êµ¬ì‚¬í•­ (Streamlit)

### 4.1 í…Œì´ë¸” ì»¬ëŸ¼ (ìˆœì„œ ê³ ì •)
```python
["invoice_no", "route", "carrier_mode", "sku_summary", "onboard_date", "eta_text"]
```

### 4.2 ìŠ¤íƒ€ì¼ë§

#### ETA ìƒ‰ìƒ
- `eta_color`ì— ë”°ë¼ `eta_text`ì˜ í…ìŠ¤íŠ¸ ìƒ‰ìƒ ì§€ì •
- ìƒ‰ìƒ íŒ”ë ˆíŠ¸:
  ```python
  {
      "red": "#ef4444",     # ë¹¨ê°•
      "green": "#22c55e",   # ì´ˆë¡
      "gray": "#9ca3af",    # íšŒìƒ‰
      "orange": "#f59e0b",  # ì£¼í™©
  }
  ```

#### SKU ìƒ‰ìƒ
- `sku_summary` ì¤‘ **ëŒ€í‘œ SKU** í…ìŠ¤íŠ¸ì— `sku_color_map[ëŒ€í‘œSKU]` ìƒ‰ìƒ ì ìš©
- ê°€ë…ì„±ì„ ìœ„í•´ ëª…ë„ ë³´ì • ê°€ëŠ¥
- HTML íƒœê·¸ ì‚¬ìš©: `<span style="color:{hexc}; font-weight:600">{text}</span>`

#### ê°•ì¡° í‘œì‹œ
- `invoice_no`: ì¢Œì¸¡ ì •ë ¬, êµµê²Œ (`font-weight: 600`)
- `route`: êµµê²Œ (`font-weight: 600`)

### 4.3 ì •ë ¬/í•„í„°
- **ê¸°ë³¸ ì •ë ¬**: `onboard_date` ë‚´ë¦¼ì°¨ìˆœ (ìµœì‹  ì¶œë°œì´ ìœ„ë¡œ)
- **ì„ íƒ í•„í„°** (ì˜µì…˜): ì„¼í„°, êµ­ê°€, ìš´ì†¡ëª¨ë“œ
- **ìƒíƒœ ë±ƒì§€/ì•„ì´ì½˜ ì—†ìŒ**: ë‚ ì§œ ìƒ‰ë§Œìœ¼ë¡œ ì‹ í˜¸

### 4.4 ì„±ëŠ¥
- **ëª©í‘œ**: 1ë§Œ í–‰ ê¸°ì¤€ ë³€í™˜ â‰¤ 200ms, ë Œë” â‰¤ 500ms

---

## 5. ì‚°ì¶œë¬¼ (Deliverables)

### 5.1 ì½”ë“œ íŒŒì¼
```
scm_dashboard_v9/
â”œâ”€â”€ ui/
â”‚   â””â”€â”€ inbound_table.py          # ë©”ì¸ ëª¨ë“ˆ
â””â”€â”€ tests/
    â””â”€â”€ test_inbound_table.py     # í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤
```

### 5.2 í•¨ìˆ˜ API

#### `build_inbound_table(inbound_raw: pd.DataFrame, sku_color_map: dict[str, str]) -> pd.DataFrame`
- **ì…ë ¥**:
  - `inbound_raw`: ì›ë³¸ ì…ê³  ì˜ˆì • ë°ì´í„°í”„ë ˆì„
  - `sku_color_map`: SKUë³„ ìƒ‰ìƒ ë§¤í•‘ (ì˜ˆ: `{"BA00021": "#4E79A7"}`)
- **ì¶œë ¥**: ë³€í™˜ëœ í…Œì´ë¸” ë°ì´í„°í”„ë ˆì„
- **ê¸°ëŠ¥**:
  - ì¸ë³´ì´ìŠ¤ë³„ ê·¸ë£¹í•‘
  - ëŒ€í‘œ SKU ì„ ì •
  - SKU ìš”ì•½ ìƒì„±
  - ETA ìƒ‰ìƒ ê·œì¹™ ì ìš©
  - HTML ìƒ‰ìƒ íƒœê·¸ ìƒì„±

#### `render_inbound_table(df: pd.DataFrame, title: str = "ğŸ“¦ ì…ê³  ì˜ˆì • í˜„í™©", height: int = 600) -> None`
- **ì…ë ¥**:
  - `df`: `build_inbound_table()`ì˜ ì¶œë ¥ ë°ì´í„°í”„ë ˆì„
  - `title`: í…Œì´ë¸” ì œëª©
  - `height`: í…Œì´ë¸” ë†’ì´ (í”½ì…€)
- **ì¶œë ¥**: ì—†ìŒ (Streamlit UI ë Œë”ë§)
- **ê¸°ëŠ¥**:
  - Pandas Stylerë¡œ ìƒ‰ìƒ ì ìš©
  - HTML ë Œë”ë§ (`unsafe_allow_html=True`)
  - ìš”ì•½ í†µê³„ í‘œì‹œ (ì´ ì†¡ì¥ ìˆ˜, ì´ ìˆ˜ëŸ‰, ê¸´ê¸‰ ê±´ìˆ˜)

---

## 6. í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤

### 6.1 ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
- âœ… ë¹ˆ ë°ì´í„°í”„ë ˆì„ ì²˜ë¦¬
- âœ… ì¸ë³´ì´ìŠ¤ë³„ ê·¸ë£¹í•‘
- âœ… ëŒ€í‘œ SKU ì„ ì • (ìˆ˜ëŸ‰ ìµœë‹¤)
- âœ… ë™ì¼ ìˆ˜ëŸ‰ ì‹œ ì‚¬ì „ìˆœ ì„ ì •
- âœ… SKU ìš”ì•½ í¬ë§· (`"SKU: N,NNNea ì™¸ Nì¢…"`)
- âœ… ETA ìƒ‰ìƒ ê·œì¹™ (red/green/gray/orange)
- âœ… ê²½ë¡œ í¬ë§· (`"KR â†’ US"`)
- âœ… HTML ìƒ‰ìƒ ì ìš©

### 6.2 ì—£ì§€ ì¼€ì´ìŠ¤
- âœ… ë‚ ì§œ ê²°ì¸¡ê°’ ì²˜ë¦¬ (`null` â†’ `"ë¯¸í™•ì¸"`)
- âœ… `"not_defined"` ì²˜ë¦¬ (â†’ `"ë¯¸í™•ì¸"`, `orange`)
- âœ… ì˜ëª»ëœ ë‚ ì§œ ë¬¸ìì—´ ì²˜ë¦¬
- âœ… ìˆ˜ëŸ‰ 0 ì²˜ë¦¬
- âœ… SKUê°€ ìƒ‰ìƒ ë§µì— ì—†ëŠ” ê²½ìš° (â†’ ê¸°ë³¸ íšŒìƒ‰ `#6b7280`)

### 6.3 ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
- âœ… 1ë§Œ í–‰ (1000 ì¸ë³´ì´ìŠ¤ Ã— 10 SKU) ë³€í™˜ â‰¤ 200ms

---

## 7. ìˆ˜ìš© ê¸°ì¤€ (Acceptance Criteria)

### âœ… í•„ìˆ˜ ìš”êµ¬ì‚¬í•­
1. **6ê°œ ì»¬ëŸ¼ë§Œ ë…¸ì¶œ**: ì£¼ë¬¸ë²ˆí˜¸/ê²½ë¡œ/ìš´ì†¡ëª¨ë“œ/SKU ìš”ì•½/ë°œì†¡ì¼/ETA
2. **ETA ìƒ‰ìƒ ê·œì¹™**:
   - ê³¼ê±° = ë¹¨ê°• (`red`)
   - 5ì¼ ì´ë‚´ = ì´ˆë¡ (`green`)
   - ë¯¸í™•ì¸ = ì£¼í™© (`orange`)
   - ê·¸ ì™¸ = íšŒìƒ‰ (`gray`)
3. **SKU ìš”ì•½ í¬ë§·**: `"ëŒ€í‘œ SKU(ìˆ˜ëŸ‰ ìµœë‹¤): ìˆ˜ëŸ‰ ì™¸ nì¢…"`
4. **ëŒ€í‘œ SKU í…ìŠ¤íŠ¸ì— íŒ”ë ˆíŠ¸ ìƒ‰ ì ìš©**
5. **`onboard_date` ìµœì‹ ìˆœ ì •ë ¬**
6. **1ë§Œ í–‰ ê¸°ì¤€ ë³€í™˜ â‰¤ 200ms**

### âœ… ì¶”ê°€ ì‚¬í•­
- **ë¬¸ì„œí™”**: Docstring í¬í•¨ (í•¨ìˆ˜ ì„¤ëª…, Args, Returns, Examples)
- **í…ŒìŠ¤íŠ¸**: `tests/test_inbound_table.py`ì— 17ê°œ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤
- **ì½”ë“œ ìŠ¤íƒ€ì¼**: PEP 8 ì¤€ìˆ˜, íƒ€ì… íŒíŠ¸ í¬í•¨

---

## 8. ì‚¬ìš© ì˜ˆì‹œ

```python
import pandas as pd
from scm_dashboard_v9.ui.inbound_table import build_inbound_table, render_inbound_table
from scm_dashboard_v9.ui.charts.colors import sku_color_map

# 1. ì›ë³¸ ë°ì´í„° ë¡œë“œ
inbound_raw = pd.read_csv("inbound_data.csv")

# 2. SKU ìƒ‰ìƒ ë§¤í•‘ ìƒì„±
sku_list = inbound_raw["resource_code"].unique()
color_map = sku_color_map(sku_list)

# 3. í…Œì´ë¸” ë¹Œë“œ
inbound_table = build_inbound_table(inbound_raw, color_map)

# 4. Streamlit ë Œë”ë§
render_inbound_table(inbound_table, title="ğŸ“¦ ì…ê³  ì˜ˆì • í˜„í™©", height=600)
```

---

## 9. ê¸°ìˆ  ìŠ¤íƒ

- **ì–¸ì–´**: Python 3.11+
- **í”„ë ˆì„ì›Œí¬**: Streamlit â‰¥ 1.28.0
- **ë°ì´í„° ì²˜ë¦¬**: Pandas â‰¥ 1.5.0
- **í…ŒìŠ¤íŠ¸**: pytest â‰¥ 7.0.0

---

## 10. ë³€ê²½ ì´ë ¥

| ë²„ì „ | ë‚ ì§œ | ë³€ê²½ ë‚´ìš© |
|------|------|-----------|
| 1.0.0 | 2025-11-11 | ì´ˆê¸° êµ¬í˜„ |

---

## 11. ì°¸ê³  ìë£Œ

- [Streamlit Dataframe Documentation](https://docs.streamlit.io/library/api-reference/data/st.dataframe)
- [Pandas Styler API](https://pandas.pydata.org/docs/reference/style.html)
- [SCM Dashboard v9 Architecture](../v9_ai_integration_guide.md)
